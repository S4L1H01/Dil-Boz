<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dil-Boz Online ðŸŒ€</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --discord-blue: #7289da; --dark-bg: #2c2f33; }
        body { background: var(--dark-bg); color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        .screen { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .active { display: flex; }
        .panel { background: #23272a; padding: 30px; border-radius: 20px; border: 2px solid var(--discord-blue); width: 85%; max-width: 500px; text-align: center; }
        
        #lobby-area { width: 100%; height: 250px; background: #2f3136; border-radius: 15px; position: relative; margin: 15px 0; border: 1px inset #222; }
        
        /* DÃœZELTÄ°LMÄ°Åž BALONCUKLAR */
        .player-bubble { 
            position: absolute; padding: 12px 20px; background: var(--discord-blue); 
            border-radius: 50px; cursor: grab; font-weight: bold; user-select: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4); z-index: 10;
        }
        .player-bubble:active { cursor: grabbing; }

        .link-box { background: #40444b; border-radius: 50px; padding: 10px; margin: 10px 0; font-size: 0.9rem; border: 1px solid #5865f2; }
        input { background: #40444b; color: white; border: none; padding: 12px; border-radius: 8px; margin: 5px; width: 80%; }
        button { background: var(--discord-blue); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px; }
    </style>
</head>
<body>

    <div id="login-screen" class="screen active">
        <div class="panel">
            <h1>Dil-Boz ðŸŒ€</h1>
            <input type="text" id="nick-input" placeholder="Nickini Yaz...">
            <br>
            <button onclick="hostGame()">Lobi Kur</button>
            <p>Veya</p>
            <input type="text" id="join-id" placeholder="Oda Kodunu YapÄ±ÅŸtÄ±r...">
            <button onclick="joinGame()" style="background:#43b581;">Odaya KatÄ±l</button>
        </div>
    </div>

    <div id="lobby-screen" class="screen">
        <div class="panel">
            <h2>Oda HazÄ±r!</h2>
            <div class="link-box">Oda Kodun: <b id="my-id-display">...</b></div>
            <p>Bu kodu arkadaÅŸÄ±na gÃ¶nder!</p>
            <div id="lobby-area"></div>
            <button onclick="alert('Oyun BaÅŸlatma YakÄ±nda!')">Oyunu BaÅŸlat âž”</button>
        </div>
    </div>

    <script>
        let peer;
        let conn;
        let myNick = "";
        let bubbles = {};

        function hostGame() {
            myNick = document.getElementById('nick-input').value || "Anonim";
            peer = new Peer(); // Rastgele bir ID oluÅŸturur
            peer.on('open', (id) => {
                document.getElementById('my-id-display').innerText = id;
                showScreen('lobby-screen');
                addBubble(id, myNick, true);
            });
            peer.on('connection', (c) => {
                conn = c;
                setupChat();
            });
        }

        function joinGame() {
            myNick = document.getElementById('nick-input').value || "Misafir";
            let targetId = document.getElementById('join-id').value;
            peer = new Peer();
            peer.on('open', (id) => {
                conn = peer.connect(targetId);
                showScreen('lobby-screen');
                document.getElementById('my-id-display').innerText = targetId;
                setupChat();
                // KatÄ±ldÄ±ÄŸÄ±nÄ± haber ver
                setTimeout(() => conn.send({type: 'join', nick: myNick, id: id}), 1000);
                addBubble(id, myNick, true);
            });
        }

        function setupChat() {
            conn.on('data', (data) => {
                if(data.type === 'join') addBubble(data.id, data.nick, false);
                if(data.type === 'move') updateBubblePos(data.id, data.x, data.y);
            });
        }

        function addBubble(id, nick, isMe) {
            if(bubbles[id]) return;
            const b = document.createElement('div');
            b.className = 'player-bubble';
            b.innerText = nick;
            b.id = "bubble-" + id;
            b.style.left = "50px"; b.style.top = "50px";
            
            if(isMe) {
                b.style.border = "2px solid white";
                makeDraggable(b, id);
            }
            
            document.getElementById('lobby-area').appendChild(b);
            bubbles[id] = b;
        }

        function makeDraggable(el, id) {
            let x = 0, y = 0, x_old = 0, y_old = 0;
            el.onmousedown = (e) => {
                e.preventDefault();
                x_old = e.clientX; y_old = e.clientY;
                document.onmousemove = (e) => {
                    x = x_old - e.clientX; y = y_old - e.clientY;
                    x_old = e.clientX; y_old = e.clientY;
                    let newTop = el.offsetTop - y;
                    let newLeft = el.offsetLeft - x;
                    
                    // SÄ±nÄ±rlarÄ± koru (Lobi alanÄ±ndan Ã§Ä±kmasÄ±n)
                    if(newTop > 0 && newTop < 200) el.style.top = newTop + "px";
                    if(newLeft > 0 && newLeft < 350) el.style.left = newLeft + "px";
                    
                    // Pozisyonu diÄŸerine gÃ¶nder
                    if(conn) conn.send({type: 'move', id: id, x: el.style.left, y: el.style.top});
                };
                document.onmouseup = () => { document.onmousemove = null; };
            };
        }

        function updateBubblePos(id, x, y) {
            let b = document.getElementById("bubble-" + id);
            if(b) { b.style.left = x; b.style.top = y; }
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>